# NATS Server Configuration with mTLS
# =====================================
# Uses SPIRE SVIDs for mutual TLS authentication

# Server identification
server_name: gitlab-sre-nats

# Ports
port: 4222
http_port: 8222

# JetStream configuration
jetstream {
    store_dir: /data
    max_memory_store: 1G
    max_file_store: 10G
}

# TLS Configuration (via SPIRE)
tls {
    cert_file: "/run/spire/certs/svid.pem"
    key_file: "/run/spire/certs/key.pem"
    ca_file: "/run/spire/certs/bundle.pem"
    
    # Client certificate requirement
    # Set to true for full mTLS, false for server-TLS only
    # Currently: server-TLS (clients verify server, server doesn't require client certs)
    verify: false
    
    # TLS timeout
    timeout: 2.0
}

# Logging
log_file: "/data/nats.log"
logtime: true
debug: false
trace: false

# Limits
max_connections: 1000
max_payload: 8MB
max_pending: 64MB

# Cluster (for future multi-node)
# cluster {
#     name: ravenhelm-nats
#     port: 6222
# }

