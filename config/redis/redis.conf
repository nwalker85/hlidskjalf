# Redis Configuration with mTLS
# ===============================
# Uses SPIRE SVIDs for mutual TLS authentication

# Network
bind 0.0.0.0
port 0
# TLS port instead of plain port
tls-port 6379

# TLS Configuration (via SPIRE - files owned by redis user)
tls-cert-file /run/spire/certs/svid.pem
tls-key-file /run/spire/certs/key.pem
tls-ca-cert-file /run/spire/certs/bundle.pem

# Client certificate requirement
# Set to 'yes' for full mTLS, 'no' for server-TLS only
tls-auth-clients no

# TLS protocols (modern only)
tls-protocols "TLSv1.2 TLSv1.3"

# Cipher suites (strong ciphers only)
tls-ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256

# Persistence
appendonly yes
appendfsync everysec
dir /data

# Memory management
maxmemory 256mb
maxmemory-policy allkeys-lru

# Logging
loglevel notice

# Security
protected-mode yes

# Authentication
# Password is stored in LocalStack: ravenhelm/dev/redis/password
# For local dev, we use this static password. In production, use dynamic secrets.
requirepass ravenhelm-redis-dev-password

# ACL Configuration (Redis 6+)
# Default user can only ping and authenticate
user default on >ravenhelm-redis-dev-password ~* &* +@all

# Disable dangerous commands
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command DEBUG ""
rename-command CONFIG ""

